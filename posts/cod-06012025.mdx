---
title: "ETag no Spring Boot 3: Otimizando sua API REST"
description: "Aprenda como implementar ETag no Spring Boot 3 para melhorar a performance de suas APIs REST.."
date: Jan 06 2025
---

## Introdu√ß√£o

O ETag (Entity Tag) √© um recurso poderoso em APIs RESTful que ajuda a otimizar o desempenho, reduzir a largura de banda e melhorar a experi√™ncia do cliente. Ele permite que os clientes validem se um recurso foi modificado antes de fazer o download de novos dados, tornando as opera√ß√µes mais eficientes.

Neste post, exploraremos como configurar e usar ETag em uma API desenvolvida com **Spring Boot 3**.

## O que √© ETag?

ETag √© um identificador √∫nico associado a uma vers√£o espec√≠fica de um recurso. Sempre que um recurso √© alterado, o ETag √© atualizado. O cliente pode usar esse ETag para verificar se o recurso foi modificado antes de buscar ou atualizar os dados.

**Principais benef√≠cios do ETag:**
- **Redu√ß√£o de Largura de Banda**: Evita o download de recursos n√£o alterados.
- **Desempenho**: Diminui a carga no servidor e melhora o tempo de resposta.
- **Cacheamento Inteligente**: Permite que clientes mantenham vers√µes em cache validadas.

---

## Funcionamento do ETag

O ETag funciona por meio de cabe√ßalhos HTTP:

1. **Servidor envia o ETag no cabe√ßalho de resposta (`ETag`)**:
- O cliente armazena o ETag para futuras valida√ß√µes.

2. **Cliente envia o ETag no cabe√ßalho de requisi√ß√£o (`If-None-Match`)**:
- O servidor verifica o ETag enviado com a vers√£o atual do recurso.

3. **Servidor retorna a resposta**:
- Se o recurso n√£o foi modificado: `304 Not Modified`.
- Se o recurso foi modificado: `200 OK` com o novo conte√∫do.

---

## Configurando ETag no Spring Boot 3

O Spring Boot 3 facilita a implementa√ß√£o de ETags com o uso de **ResponseEntity** e APIs personalizadas.

### Exemplo de Implementa√ß√£o

Aqui est√° um exemplo pr√°tico de um endpoint que utiliza ETag:

```java
package com.example.demo.controller;

import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RestController;

import java.util.Objects;

@RestController
public class ETagController {

    private final String currentResourceData = "Dados do recurso atual";

    @GetMapping("/resource")
    public ResponseEntity<String> getResource(
            @RequestHeader(value = HttpHeaders.IF_NONE_MATCH, required = false) String ifNoneMatch) {

        // Gerando o ETag
        String eTag = "\"" + Integer.toHexString(Objects.hashCode(currentResourceData)) + "\"";

        // Validando o ETag recebido
        if (eTag.equals(ifNoneMatch)) {
            return ResponseEntity.status(HttpStatus.NOT_MODIFIED).eTag(eTag).build();
        }

        // Retornando o recurso com o ETag
        return ResponseEntity.ok().eTag(eTag).body(currentResourceData);
    }
}
```

### Explica√ß√£o do C√≥digo
- **C√°lculo do ETag:** O ETag √© gerado como um hash √∫nico do conte√∫do do recurso.
- **Valida√ß√£o do ETag:** O cabe√ßalho If-None-Match √© verificado para determinar se o recurso foi alterado.
- **Resposta Condicional:** Retorna 304 Not Modified quando o recurso n√£o foi alterado.

### Testando o Endpoint com cURL

1. **Primeira Requisi√ß√£o:**:

```javascript
curl -i http://localhost:8080/resource
```
- Resposta:
```javascript
HTTP/1.1 200 OK
ETag: "d2c7df3"
Content-Type: text/plain
Content-Length: 21

Dados do recurso atual
```

2. **Requisi√ß√£o com ETag:**:

```javascript
curl -i -H "If-None-Match: \"d2c7df3\"" http://localhost:8080/resource
```
- Resposta:
```javascript
HTTP/1.1 304 Not Modified
```
---
### Boas Pr√°ticas

- **C√°lculo de ETags:**
    Utilize algoritmos de hash confi√°veis (ex.: SHA256) para garantir identificadores √∫nicos.
- **Integra√ß√£o com Cache-Control:**
    Combine ETags com cabe√ßalhos de cache como Cache-Control para maximizar o desempenho.
- **Versionamento de Recursos:**
    Garanta que o ETag seja atualizado sempre que um recurso for modificado.
---
### Conclus√£o

ETag √© uma ferramenta poderosa para otimizar o desempenho de APIs RESTful no Spring Boot 3. Com uma configura√ß√£o simples, voc√™ pode reduzir a largura de banda, melhorar o tempo de resposta e oferecer uma experi√™ncia mais eficiente para os clientes.

Experimente implementar ETags em sua API e aproveite seus benef√≠cios!
---

**üîó Reposit√≥rio de Exemplos**

Aqui o link para nosso laborat√≥rio: [https://github.com/Nosbielc/nosbielc-dev-demos](https://github.com/Nosbielc/nosbielc-dev-demos)